<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ポータルマスター 使い方ガイド</title>
    <style>
        body {
            font-family: 'Yu Gothic', 'Meiryo', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .nav {
            background: #2c3e50;
            padding: 0;
        }
        .nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
        }
        .nav li {
            flex: 1;
            min-width: 150px;
        }
        .nav a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px;
            text-align: center;
            border-right: 1px solid #34495e;
            transition: background-color 0.3s;
        }
        .nav a:hover {
            background-color: #34495e;
        }
        .content {
            padding: 40px;
        }
        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .section h2 {
            color: #2c3e50;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .section h3 {
            color: #34495e;
            margin-top: 25px;
        }
        .menu-item {
            background: white;
            margin: 15px 0;
            padding: 20px;
            border-radius: 6px;
            border-left: 3px solid #3498db;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .menu-item h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1.2em;
        }
        .menu-item .function-name {
            background: #ecf0f1;
            padding: 3px 8px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
            color: #7f8c8d;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .warning h4 {
            color: #856404;
            margin: 0 0 10px 0;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .info h4 {
            color: #0c5460;
            margin: 0 0 10px 0;
        }
        .step-list {
            counter-reset: step-counter;
        }
        .step {
            counter-increment: step-counter;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #27ae60;
            position: relative;
        }
        .step::before {
            content: counter(step-counter);
            position: absolute;
            left: -15px;
            top: 15px;
            background: #27ae60;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .step-content {
            margin-left: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #667eea;
            color: white;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
        }
        @media (max-width: 768px) {
            .nav ul {
                flex-direction: column;
            }
            .nav li {
                min-width: auto;
            }
            .nav a {
                border-right: none;
                border-bottom: 1px solid #34495e;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 ポータルマスター</h1>
            <p>学校業務支援システム - 最新版使い方ガイド v2.0</p>
        </div>

        <nav class="nav">
            <ul>
                <li><a href="#overview">概要</a></li>
                <li><a href="#initial-setup">初期設定</a></li>
                <li><a href="#daily-use">日常業務</a></li>
                <li><a href="#reporting">報告書作成</a></li>
                <li><a href="#system-management">システム管理</a></li>
                <li><a href="#maintenance">メンテナンス</a></li>
                <li><a href="#troubleshooting">トラブル対処</a></li>
            </ul>
        </nav>

        <div class="content">
            <section id="overview" class="section">
                <h2>🎯 システム概要</h2>
                <p>ポータルマスター v2.0は、小学校の年間行事管理を効率化する高性能Google Apps Scriptシステムです。新しい直感的メニューと、改善されたパフォーマンスで、より快適な学校業務を実現します。</p>
                
                <div class="info">
                    <h4>🆕 v2.0の主な改善点</h4>
                    <ul>
                        <li><strong>🎆 新しいメニュー:</strong> 絵文字アイコンで直感的な操作</li>
                        <li><strong>⚡ 性能向上:</strong> バッチ処理で高速化</li>
                        <li><strong>🔗 統一管理:</strong> 共通関数で保守性向上</li>
                        <li><strong>🛡️ エラー処理:</strong> 強化された例外処理</li>
                        <li><strong>🎯 新機能:</strong> ガイド表示、年度更新ファイル作成など</li>
                        <li><strong>ℹ️ 製作者情報:</strong> メニューから製作者情報を確認可能</li>
                    </ul>
                </div>
                
                <h3>主な機能</h3>
                <ul>
                    <li><strong>年間行事管理</strong>：Excelからの行事予定インポートと管理</li>
                    <li><strong>日直管理</strong>：職員の日直当番の自動割り当て</li>
                    <li><strong>週報作成</strong>：PDF形式での週報自動生成</li>
                    <li><strong>時数計算</strong>：学年別授業時数の自動集計</li>
                    <li><strong>カレンダー連携</strong>：Googleカレンダーとの自動同期</li>
                    <li><strong>自動化</strong>：定期処理のトリガー設定</li>
                </ul>

                <div class="info">
                    <h4>📋 必要な権限</h4>
                    <p>このシステムは以下のGoogle サービスにアクセスします：</p>
                    <ul>
                        <li>Google スプレッドシート（データ管理）</li>
                        <li>Google ドライブ（ファイル保存）</li>
                        <li>Google カレンダー（行事予定同期）</li>
                    </ul>
                </div>
            </section>

            <section id="initial-setup" class="section">
                <h2>⚙️ 初期設定手順</h2>
                <p>システムを初めて使用する際は、必ず以下の手順で初期設定を行ってください。</p>

                <div class="info">
                    <h4>🎯 新しいメニューアクセス</h4>
                    <p>スプレッドシートのメニューバーから<strong>「🎯 ポータルマスター」</strong>をクリックし、以下の4つのカテゴリーから選択してください。</p>
                </div>

                <div class="step-list">
                    <div class="step">
                        <div class="step-content">
                            <h4>📥 年間行事計画をインポート</h4>
                            <p><span class="function-name">importAnnualEvents</span></p>
                            <p>Excel形式の年間行事計画をスプレッドシートにインポートします。</p>
                            <ul>
                                <li><strong>🎯 ポータルマスター</strong> → <strong>🏗️ 初回セットアップ</strong> → <strong>📥 年間行事計画をインポート</strong></li>
                                <li>ダイアログでExcelファイルのURLを入力</li>
                                <li>「年度更新作業」シートのC11セルに基準日を事前設定</li>
                                <li>日付の自動補完と整合性チェック機能付き</li>
                            </ul>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-content">
                            <h4>👥 日直を自動割り当て</h4>
                            <p><span class="function-name">assignDuty</span></p>
                            <p>「日直表」シートの情報を基に、マスターシートに日直を高速自動割り当てします。</p>
                            <ul>
                                <li><strong>🎯 ポータルマスター</strong> → <strong>🏗️ 初回セットアップ</strong> → <strong>👥 日直を自動割り当て</strong></li>
                                <li>事前に「日直表」シートに職員名（姓名をスペースで区切り）と日直番号を入力</li>
                                <li>改善された名前処理で全角・半角スペースに対応</li>
                                <li>循環的な日直割り当てで公平性を保証</li>
                            </ul>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-content">
                            <h4>📋 行事予定表へ反映</h4>
                            <p><span class="function-name">updateAnnualEvents</span></p>
                            <p>マスターシートのデータを「年間行事予定表」シートに高速バッチ処理で反映させます。</p>
                            <ul>
                                <li><strong>🎯 ポータルマスター</strong> → <strong>🏗️ 初回セットアップ</strong> → <strong>📋 行事予定表へ反映</strong></li>
                                <li>パフォーマンスが大幅に改善（従来の36倍高速）</li>
                                <li>6x6の校時データを一括バッチ処理</li>
                                <li>処理完了後、マスターシートは自動的に非表示</li>
                                <li>以後は「年間行事予定表」シートを直接編集</li>
                            </ul>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-content">
                            <h4>📊 累計時数を初期計算</h4>
                            <p><span class="function-name">calculateCumulativeHours</span></p>
                            <p>各学年の授業時数を累計計算し、土曜日の計算ロジックを改善しました。</p>
                            <ul>
                                <li><strong>🎯 ポータルマスター</strong> → <strong>🏗️ 初回セットアップ</strong> → <strong>📊 累計時数を初期計算</strong></li>
                                <li>最新の土曜日までの累計時数を「累計時数」シートに出力</li>
                                <li>今日が土曜日の場合は今日を基準日として計算</li>
                                <li>共通関数による統一されたカテゴリー管理</li>
                            </ul>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-content">
                            <h4>⚙️ 自動処理を設定</h4>
                            <p><span class="function-name">setAutomaticProcesses</span></p>
                            <p>定期的な自動処理を設定し、日常業務を効率化します。</p>
                            <ul>
                                <li><strong>🎯 ポータルマスター</strong> → <strong>🏗️ 初回セットアップ</strong> → <strong>⚙️ 自動処理を設定</strong></li>
                                <li>以下の処理が自動化されます：</li>
                                <ul>
                                    <li><strong>毎週月曜日 午前2時:</strong> 週報PDF保存・累計時数計算</li>
                                    <li><strong>毎日 午前3時:</strong> Googleカレンダー同期</li>
                                    <li><strong>毎日 午前4時:</strong> 今日の日付へ移動</li>
                                </ul>
                                <li>エラー処理やフォールバック機能を強化</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="warning">
                    <h4>⚠️ 初期設定の注意点</h4>
                    <ul>
                        <li>手順は必ず1→2→3→4→5の順序で実行してください</li>
                        <li>「年度更新作業」シートに必要な設定値が入力されていることを確認してください</li>
                        <li>「日直表」シートの形式が正しく設定されていることを確認してください</li>
                    </ul>
                </div>
            </section>

            <section id="daily-use" class="section">
                <h2>📅 日常業務での使用方法</h2>
                
                <div class="info">
                    <h4>📱 新しいメニューアクセス</h4>
                    <p><strong>🎯 ポータルマスター</strong> → <strong>📅 日常業務</strong> から各機能を選択してください。</p>
                </div>

                <div class="menu-item">
                    <h4>📄 週報をPDF保存</h4>
                    <p><span class="function-name">saveToPDF</span></p>
                    <p>「週報（時数あり）」と「週報（時数あり）次週」シートを高品質PDF形式で保存します。</p>
                    <ul>
                        <li><strong>メニュー:</strong> 📅 日常業務 → 📄 週報をPDF保存</li>
                        <li>行の高さを自動調整（U41セルの内容に基づく）</li>
                        <li>ファイル名は自動生成（B1～D1 + 日付範囲）</li>
                        <li>週報フォルダに保存（同名ファイルは上書き）</li>
                        <li>統一されたフォルダ管理（C14セルで一元管理）</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>📁 週報フォルダを開く</h4>
                    <p><span class="function-name">openWeeklyReportFolder</span></p>
                    <p>PDF保存先の週報フォルダをブラウザで素早く開きます。</p>
                    <ul>
                        <li><strong>メニュー:</strong> 📅 日常業務 → 📁 週報フォルダを開く</li>
                        <li>フォルダが存在しない場合は自動作成</li>
                        <li>フォルダIDは統一管理（C14セル）で整合性を保証</li>
                        <li>共通関数による安定したフォルダ管理</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>⭐ 休業期間日直をカウント</h4>
                    <p><span class="function-name">countStars</span></p>
                    <p>年間行事予定表の日直欄にある「☆」マークを精密にカウントし、日直表に集計します。</p>
                    <ul>
                        <li><strong>メニュー:</strong> 📅 日常業務 → ⭐ 休業期間日直をカウント</li>
                        <li>「年間行事予定表」R列の☆マークを職員名で集計</li>
                        <li>結果は「日直表」E列に自動出力</li>
                        <li>改善された名前処理（全角・半角スペース統一対応）</li>
                        <li>共通関数による安定した名前抽出</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>🔗 今日の日付へ移動</h4>
                    <p><span class="function-name">setDailyHyperlink</span></p>
                    <p>B1セルに今日の日付へのハイパーリンクを設定し、素早くジャンプできます。</p>
                    <ul>
                        <li><strong>メニュー:</strong> 📅 日常業務 → 🔗 今日の日付へ移動</li>
                        <li>自動で今日の日付を検索し、該当行へのリンクを作成</li>
                        <li>日付が見つからない場合はエラーメッセージを表示</li>
                        <li>毎日自動実行されるため、手動実行は不要</li>
                    </ul>
                </div>
            </section>

            <section id="reporting" class="section">
                <h2>📊 集計・レポート機能</h2>
                
                <div class="info">
                    <h4>📱 新しいメニューアクセス</h4>
                    <p><strong>🎯 ポータルマスター</strong> → <strong>📊 集計・レポート</strong> から各機能を選択してください。</p>
                </div>

                <div class="menu-item">
                    <h4>📈 学年別授業時数を集計</h4>
                    <p><span class="function-name">aggregateSchoolEventsByGrade</span></p>
                    <p>指定期間の学年別授業時数を低・中・高学年別に詳細集計します。</p>
                    
                    <h5>使用手順：</h5>
                    <ol>
                        <li><strong>メニュー:</strong> 📊 集計・レポート → 📈 学年別授業時数を集計</li>
                        <li>改善されたダイアログで集計期間と標準授業時数を入力</li>
                        <li>「低学年」「中学年」「高学年」シートが自動作成される</li>
                        <li>共通関数による統一されたカテゴリー管理</li>
                    </ol>

                    <h5>出力内容：</h5>
                    <table>
                        <tr>
                            <th>分類</th>
                            <th>対象学年</th>
                            <th>集計項目</th>
                        </tr>
                        <tr>
                            <td>低学年</td>
                            <td>1・2年</td>
                            <td rowspan="3">授業時数、儀式、文化、保健、遠足、勤労、欠時数、児童会、クラブ、委員会活動、補習</td>
                        </tr>
                        <tr>
                            <td>中学年</td>
                            <td>3・4年</td>
                        </tr>
                        <tr>
                            <td>高学年</td>
                            <td>5・6年</td>
                        </tr>
                    </table>
                </div>

                <div class="menu-item">
                    <h4>🧮 累計時数を再計算</h4>
                    <p><span class="function-name">calculateCumulativeHours</span></p>
                    <p>直近の土曜日までの累計授業時数を再計算します。</p>
                    <ul>
                        <li><strong>メニュー:</strong> 📊 集計・レポート → 🧮 累計時数を再計算</li>
                        <li>今日が土曜日の場合は今日を基準として計算</li>
                        <li>各学年の累計時数を「累計時数」シートに出力</li>
                        <li>初回セットアップ後の定期的な更新に使用</li>
                        <li>共通関数による改善された土曜日計算ロジック</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>📋 日直のみ更新</h4>
                    <p><span class="function-name">updateAnnualDuty</span></p>
                    <p>マスターシートの日直情報のみを年間行事予定表に反映します。</p>
                    <ul>
                        <li><strong>メニュー:</strong> 📊 集計・レポート → 📋 日直のみ更新</li>
                        <li>行事情報は変更せず、日直情報（R列）のみ更新</li>
                        <li>日直の変更や調整後の部分的な更新に最適</li>
                        <li>全体更新よりも高速で実行可能</li>
                    </ul>
                </div>

                <div class="info">
                    <h4>📈 時数集計のポイント</h4>
                    <ul>
                        <li>「○」マークは授業時数としてカウント</li>
                        <li>行事カテゴリー（儀式、文化等）は短縮形で入力</li>
                        <li>月別での詳細な内訳を確認可能</li>
                        <li>標準授業時数と実施時数の比較が容易</li>
                    </ul>
                </div>
            </section>

            <section id="system-management" class="section">
                <h2>🔧 システム管理機能</h2>
                
                <div class="info">
                    <h4>📱 新しいメニューアクセス</h4>
                    <p><strong>🎯 ポータルマスター</strong> → <strong>🔧 システム管理</strong> から各機能を選択してください。</p>
                </div>

                <div class="menu-item">
                    <h4>📅 カレンダーと同期</h4>
                    <p><span class="function-name">syncCalendars</span></p>
                    <p>年間行事予定表の内容をGoogleカレンダーに同期します。</p>
                    <ul>
                        <li><strong>メニュー:</strong> 🔧 システム管理 → 📅 カレンダーと同期</li>
                        <li>「行事予定カレンダー」（D列）と「対外行事カレンダー」（M列）を作成</li>
                        <li>時間指定がある場合は時間付きイベント、なければ終日イベント</li>
                        <li>日本の祝日と重複するイベントは除外</li>
                        <li>カレンダーIDは自動で管理され、削除されても再作成される</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>📋 年度更新ファイル作成</h4>
                    <p><span class="function-name">CopyAndClear</span></p>
                    <p>現在のスプレッドシートをコピーし、新年度用にデータをクリアしたファイルを作成します。</p>
                    <ul>
                        <li><strong>メニュー:</strong> 🔧 システム管理 → 📋 年度更新ファイル作成</li>
                        <li>年度更新作業シートC5（ファイル名）とC7（フォルダID）の設定に基づいて実行</li>
                        <li>新年度用にマスターシートなどのデータを自動クリア</li>
                        <li>設定値は保持され、行事予定のみリセット</li>
                        <li>作成されたファイルは指定フォルダに保存</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>❓ 使い方ガイドを表示</h4>
                    <p><span class="function-name">showUserGuide</span></p>
                    <p>このガイドをスプレッドシート内のダイアログで表示します。</p>
                    <ul>
                        <li><strong>メニュー:</strong> 🔧 システム管理 → ❓ 使い方ガイドを表示</li>
                        <li>HTMLファイルが見つからない場合は簡易版ガイドを表示</li>
                        <li>システム内で直接ヘルプを参照可能</li>
                        <li>最新の機能情報を確認可能</li>
                    </ul>
                </div>
            </section>

            <section id="maintenance" class="section">
                <h2>🔧 メンテナンス・管理機能</h2>

                <h3>自動実行される機能</h3>
                <p>初期設定でトリガーを設定すると、以下の機能が自動実行されます：</p>

                <table>
                    <tr>
                        <th>機能</th>
                        <th>実行タイミング</th>
                        <th>処理内容</th>
                    </tr>
                    <tr>
                        <td>週報PDF保存</td>
                        <td>毎週月曜日 午前2時</td>
                        <td>週報シートを自動的にPDF化して保存</td>
                    </tr>
                    <tr>
                        <td>累計時数計算</td>
                        <td>毎週月曜日 午前2時</td>
                        <td>直近土曜日までの累計時数を更新</td>
                    </tr>
                    <tr>
                        <td>カレンダー同期</td>
                        <td>毎日 午前3時</td>
                        <td>年間行事予定をGoogleカレンダーに同期</td>
                    </tr>
                    <tr>
                        <td>今日の日付へ移動</td>
                        <td>毎日 午前4時</td>
                        <td>B1セルに今日の日付へのリンクを設定</td>
                    </tr>
                </table>

                <div class="info">
                    <h4>💡 自動実行の設定について</h4>
                    <p>これらの機能は初期設定で「⚙️ 自動処理を設定」を実行すると自動実行されます。手動で実行したい場合は、各対応するメニュー項目から実行してください。</p>
                </div>

                <div class="warning">
                    <h4>⚠️ カレンダー管理の注意</h4>
                    <ul>
                        <li>カレンダーIDは「年度更新作業」シートC15・C16セルに保存されます</li>
                        <li>初回実行時に新しいカレンダーが自動作成されます</li>
                        <li>削除したカレンダーを復旧する場合はIDをクリアして再実行してください</li>
                    </ul>
                </div>
            </section>

            <section id="troubleshooting" class="section">
                <h2>🚨 トラブルシューティング</h2>

                <h3>よくある問題と解決方法</h3>

                <div class="menu-item">
                    <h4>「シートが見つかりません」エラー</h4>
                    <p><strong>原因：</strong>必要なシートが存在しない、または名前が間違っている</p>
                    <p><strong>解決方法：</strong></p>
                    <ul>
                        <li>以下のシートが存在することを確認：
                            <ul>
                                <li>年間行事予定表</li>
                                <li>年度更新作業</li>
                                <li>マスター</li>
                                <li>日直表</li>
                                <li>累計時数</li>
                                <li>時数様式</li>
                            </ul>
                        </li>
                        <li>シート名に余分な空白やタブ文字がないことを確認</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>PDF保存ができない</h4>
                    <p><strong>原因：</strong>週報フォルダの作成権限がない、またはドライブ容量不足</p>
                    <p><strong>解決方法：</strong></p>
                    <ul>
                        <li>Googleドライブの空き容量を確認</li>
                        <li>スプレッドシートが保存されているフォルダの権限を確認</li>
                        <li>「年度更新作業」シートC14セルの値をクリアして再実行</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>日直の割り当てが正しくない</h4>
                    <p><strong>原因：</strong>「日直表」シートの形式が正しくない</p>
                    <p><strong>解決方法：</strong></p>
                    <ul>
                        <li>C列に氏名（姓名をスペースで区切る）</li>
                        <li>D列に日直番号（数字）</li>
                        <li>空行がないことを確認</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>カレンダー同期が機能しない</h4>
                    <p><strong>原因：</strong>Googleカレンダーへのアクセス権限がない</p>
                    <p><strong>解決方法：</strong></p>
                    <ul>
                        <li>スクリプトエディタで権限を再承認</li>
                        <li>「年度更新作業」シートC15・C16セルをクリアして再実行</li>
                        <li>Googleカレンダーの「マイカレンダー」に新しいカレンダーが作成されることを確認</li>
                    </ul>
                </div>

                <h3>エラーログの確認方法</h3>
                <ol>
                    <li>スプレッドシートで「拡張機能」→「Apps Script」を選択</li>
                    <li>左メニューの「実行数」をクリック</li>
                    <li>実行履歴とエラー内容を確認</li>
                    <li>エラーの詳細を確認して対処</li>
                </ol>

                <div class="info">
                    <h4>💡 問題解決のヒント</h4>
                    <ul>
                        <li>エラーが発生した場合は、まずシート名と必要なデータが正しく入力されているかを確認</li>
                        <li>権限関係のエラーの場合は、スクリプトの再承認を試行</li>
                        <li>データが見つからないエラーの場合は、参照しているセル範囲を確認</li>
                        <li>解決しない場合は製作者に連絡（メニューの「製作者情報」参照）</li>
                    </ul>
                </div>
            </section>

            <section class="section">
                <h2>🔧 v2.0 技術的改善点</h2>
                <p>ポータルマスター v2.0では、システムの根本的な改善を行いました：</p>

                <div class="menu-item">
                    <h4>📁 共通関数システム</h4>
                    <p><span class="function-name">共通関数.js</span></p>
                    <p>新規作成された共通関数ファイルにより、システム全体の整合性と保守性が大幅に向上しました。</p>
                    <ul>
                        <li><strong>日付処理の統一:</strong> `formatDateToJapanese()` で一貫した日付フォーマット</li>
                        <li><strong>名前処理の標準化:</strong> `extractFirstName()` で全角・半角スペース統一処理</li>
                        <li><strong>フォルダ管理の統一:</strong> `getWeeklyReportFolderId()` で一元管理</li>
                        <li><strong>カレンダー管理の統一:</strong> `getOrCreateCalendarId()` で動的ID管理</li>
                        <li><strong>エラー処理の統一:</strong> `showAlert()`, `safeExecute()` で堅牢性向上</li>
                        <li><strong>定数管理:</strong> `EVENT_CATEGORIES`, `CONFIG_CELLS` で一元化</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>⚡ パフォーマンス改善</h4>
                    <ul>
                        <li><strong>バッチ処理導入:</strong> 従来の個別セル操作を一括処理に変更</li>
                        <li><strong>年間行事インポート:</strong> 6x6の校時データを一括設定（36倍高速化）</li>
                        <li><strong>土曜日計算ロジック:</strong> 今日が土曜日の場合の処理を改善</li>
                        <li><strong>不要パラメータ削除:</strong> 使われていない引数を整理</li>
                    </ul>
                </div>

                <div class="menu-item">
                    <h4>🛡️ 整合性・安定性向上</h4>
                    <ul>
                        <li><strong>フォルダID統一:</strong> C14セルで週報フォルダを一元管理</li>
                        <li><strong>名前処理統一:</strong> 正規表現 `/[\s\u3000]+/` で一貫処理</li>
                        <li><strong>カテゴリー統一:</strong> 行事カテゴリーを共通定数で管理</li>
                        <li><strong>エラーハンドリング強化:</strong> UI利用不可時の自動フォールバック</li>
                    </ul>
                </div>

                <h2>📝 設定シート一覧</h2>
                <p>システムが参照する重要な設定値の一覧です（v2.0で統一管理）：</p>

                <table>
                    <tr>
                        <th>シート名</th>
                        <th>セル</th>
                        <th>内容</th>
                        <th>v2.0での変更点</th>
                    </tr>
                    <tr>
                        <td rowspan="6">年度更新作業</td>
                        <td>C5</td>
                        <td>コピー先ファイル名</td>
                        <td>変更なし</td>
                    </tr>
                    <tr>
                        <td>C7</td>
                        <td>年度更新用フォルダID</td>
                        <td>年度更新ファイル作成時の保存先</td>
                    </tr>
                    <tr>
                        <td>C11</td>
                        <td>基準日（日曜日）</td>
                        <td>日付補完機能を強化</td>
                    </tr>
                    <tr>
                        <td>C14</td>
                        <td>週報フォルダID</td>
                        <td>週報PDF保存用フォルダを統一管理</td>
                    </tr>
                    <tr>
                        <td>C15</td>
                        <td>行事予定カレンダーID</td>
                        <td>動的取得機能を追加</td>
                    </tr>
                    <tr>
                        <td>C16</td>
                        <td>対外行事カレンダーID</td>
                        <td>動的取得機能を追加</td>
                    </tr>
                </table>

                <div class="info">
                    <h4>💡 v2.0での設定管理改善</h4>
                    <ul>
                        <li><strong>機能別管理:</strong> C7（年度更新用）とC14（週報用）で目的別にフォルダID管理</li>
                        <li><strong>自動復旧:</strong> IDがクリアされても自動で再作成</li>
                        <li><strong>動的管理:</strong> ハードコードされていたIDを動的取得に変更</li>
                        <li><strong>エラー耐性:</strong> 設定ミスがあっても自動で修復</li>
                    </ul>
                </div>

                <div class="warning">
                    <h4>⚠️ 設定値の変更について</h4>
                    <p>v2.0では設定値の管理が改善されましたが、手動変更時は以下に注意してください：</p>
                    <ul>
                        <li><strong>C7:</strong> 年度更新ファイル作成時の保存先フォルダID（手動設定または空白で親フォルダを使用）</li>
                        <li><strong>C14:</strong> 週報PDF保存用フォルダID（空白の場合は自動でフォルダ作成）</li>
                        <li><strong>C15, C16:</strong> カレンダーID（空白の場合は新しいカレンダーを自動作成）</li>
                        <li>基準日（C11）は日曜日の日付を設定してください</li>
                        <li>設定値の不整合は共通関数により自動修復されることがあります</li>
                    </ul>
                </div>
            </section>
        </div>

        <div class="footer">
            <p>&copy; 2024 ポータルマスター - 学校業務支援システム</p>
            <p>製作者: 中龍馬（Atari Ryuma） | 連絡先: atarirym@open.ed.jp</p>
        </div>
    </div>

    <script>
        // スムーズスクロール
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // セクションのハイライト
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.nav a');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (scrollY >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });
    </script>

    <style>
        .nav a.active {
            background-color: #667eea;
        }
    </style>
</body>
</html>